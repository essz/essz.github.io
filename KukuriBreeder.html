<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style type="text/css">
@import url('style.css');
</style>
<title>Kukuri breeder</title>
</head>

<body>

<form name="breeder">

<div id="main">

<div id="header">
    <h1>Kukuri Breeder</h1>
</div>

<div class="section">

    <h2>Dove</h2>

    <label for="dovegeno">
        <h4>Geno</h4>
    </label>
    
    <input type="text" id="mumgeno" size="40" class="fullwidth" placeholder="Enter dove's genotype" value="AA/EE" onfocusout="onChangeMumGenoFocus()"><br><br>
    <!--textarea rows="2" cols="39" id="mumcheck" class="fullwidth echo" spellcheck="false">Aa</textarea-->

    <div class="line">

        <div class="phenotype">
            <p id="mumPhenotype">Dove's phenotype will appear here</p>            
        </div>

    </div>

    <div class="line">

    	<div class="optionItem">
			<label for="mumBreed"><h4>Breed</h4></label>
			<select id="mumBreed" onchange="toggleMumFeathertypeVisibility(this.value)">
				<option>Common</option>
				<option>Prairie</option>
			</select>
		</div>

        <div class="optionItem">
			<label for="mumRank"><h4>Rank</h4></label>
			<select id="mumRank" name="mumRank">
			</select>
		</div>

    </div>

    <div class="line">

        <label for="skillPoints"><h4>Skill points</h4></label>

        <div class="skillPoints">

            <div class="optionItem">
                <input type="text" id="mumATK" size="3"  placeholder="ATK" />
            </div>

            <div class="optionItem">
                <input type="text" id="mumDEF" size="3"  placeholder="DEF" /> 
            </div>
            
            <div class="optionItem">
                <input type="text" id="mumSPD" size="3"  placeholder="SPD" />
            </div>

        </div>

    </div>

    <div class="line">

        <div class="optionItem">
			<label for="mumEars"><h4>Ears</h4></label>
			<select id="mumEars" name="mumEars">
			</select>
		</div>

        <div class="optionItem">
			<label for="mumHorns"><h4>Horns</h4></label>
			<select id="mumHorns" name="mumHorns">
			</select>
		</div>

    </div>
    
    <div class="line">

        <div class="optionItem">
            <label for="mumRuffle"><h4>Ruffle</h4></label>
            <select id="mumRuffle" name="mumRuffle">
            </select>
        </div>

        <div class="optionItem">
			<label for="mumTail"><h4>Tail</h4></label>
			<select id="mumTail" name="mumTail">
			</select>
		</div>

        <div id ="mumFeathertypeDiv" class="optionItem">
            <label for="mumFeathertype"><h4>Feathertype</h4></label>
            <select id="mumFeathertype" name="mumFeathertype">
            </select>
        </div>
    </div>

    <div class="line">

        <div class="optionItem">
            <label for="mumDiet"><h4>Diet</h4></label>
            <select id="mumDiet" name="mumDiet">
            </select>
        </div>

        <div class="optionItem">
            <label for="mumBiorythmn"><h4>Biorythmn</h4></label>
            <select id="mumBiorythmn" name="mumBiorythmn">
            </select>
        </div>

    </div>

    <div class="line">
        <label for="mumMutations"><h4>Mutations</h4></label>
        <select id="mumMutations" multiple="multiple" name="mumMutations" />
    </div>

    <div class="line">

        <label for="mumStarter"><h4>Starter</h4></label>
        <input type="checkbox" id="mumStarter" name="mumStarter" value="false"><br/>

    </div>

</div>

<div class="section">

<h2>Rook</h2>

  <label for="rookgeno">
        <h4>Geno</h4>
    </label>
    
    <input type="text" id="dadgeno" size="40" class="fullwidth" placeholder="Enter rook's genotype" value="AA/EE" onfocusout="onChangeDadGenoFocus()"><br><br>
    <!--textarea rows="2" cols="39" id="dadCheck" class="fullwidth echo" spellcheck="false">aa</textarea-->

    <div class="line">

        <div class="phenotype">
            <p id="dadPhenotype">Rook's phenotype will appear here</p>
        </div>

    </div>

    <div class="line">

        <div class="optionItem">
            <label for="dadBreed"><h4>Breed</h4></label>
            <select id="dadBreed" onchange="toggleDadFeathertypeVisibility(this.value)">
                <option>Common</option>
                <option>Prairie</option>
            </select>
        </div>

        <div class="optionItem"> 
            <label for="dadRank"><h4>Rank</h4></label>
                <select id="dadRank">
                </select>
        </div>

    </div>

        <div class="line">

        <label for="skillPoints"><h4>Skill points</h4></label>

        <div class="skillPoints">

            <div class="optionItem">
                <input type="text" id="dadATK" size="3"  placeholder="ATK" />
            </div>

            <div class="optionItem">
                <input type="text" id="dadDEF" size="3"  placeholder="DEF" /> 
            </div>
            
            <div class="optionItem">
                <input type="text" id="dadSPD" size="3"  placeholder="SPD" />
            </div>

        </div>

    </div>

    <div class="line">

        <div class="optionItem">
            <label for="dadEars"><h4>Ears</h4></label>
            <select id="dadEars" name="dadEars">
            </select>
        </div>

        <div class="optionItem">
            <label for="dadHorns"><h4>Horns</h4></label>
            <select id="dadHorns" name="dadHorns">
            </select>
        </div>

    </div>
    
    <div class="line">

        <div class="optionItem">
            <label for="dadRuffle"><h4>Ruffle</h4></label>
            <select id="dadRuffle" name="dadRuffle">
            </select>
        </div>

        <div class="optionItem">
            <label for="dadTail"><h4>Tail</h4></label>
            <select id="dadTail" name="dadTail">
            </select>
        </div>

        <div id ="dadFeathertypeDiv" class="optionItem">
            <label for="dadFeathertype"><h4>Feathertype</h4></label>
            <select id="dadFeathertype" name="dadFeathertype">
            </select>
        </div>

    </div>

    <div class="line">

        <div class="optionItem">
            <label for="dadDiet"><h4>Diet</h4></label>
            <select id="dadDiet" name="dadDiet">
            </select>
        </div>

        <div class="optionItem">
            <label for="dadBiorythmn"><h4>Biorythmn</h4></label>
            <select id="dadBiorythmn" name="dadBiorythmn">
            </select>
        </div>

    </div>

    <div class="line">
         <div class="optionItem">
            <label for="dadMutations"><h4>Mutations</h4></label>
            <select id="dadMutations" multiple="multiple" name="dadMutations" />
        </div>
     </div>

     <div class="line">
          <div class="optionItem">
            <label for="dadStarter"><h4>Starter</h4></label>
            <input type="checkbox" id="dadStarter" name="dadStarter" value="false"><br/>
         </div>
    </div>

</div>

<div class="section">

    <div class="rollTop">
         <input type="checkbox" id="inbred" name="inbred" value="Inbred" />Inbred <br />
    </div>

<button type="button" onclick='document.getElementById("babyName").innerHTML = breed()'>Roll!</button>

<p>Nest</p>
        <h4 id="babyName"></h4>

        <p id="logLink"><a href="javascript:ToggleLog()">Log</a></p>

        <textarea rows="8" cols="40" id="rollLog"></textarea>
</div>



</form>

</div>

<script>

    function ToggleLog()
    {
        if(document.getElementById("rollLog").style.display == "none" || document.getElementById("rollLog").style.display == "")
        {
            document.getElementById("rollLog").style.display = "block";
        }
        else
        {
             document.getElementById("rollLog").style.display = "none";
        }
    }

    function toggleMumFeathertypeVisibility(breed)
    {
        if(breed == "Prairie")
        {
            document.getElementById("mumFeathertypeDiv").style.display = "block";
        }
        else
        {
             document.getElementById("mumFeathertypeDiv").style.display = "none";
        }
    }

    function toggleDadFeathertypeVisibility(breed)
    {
        if(breed == "Prairie")
        {
            document.getElementById("dadFeathertypeDiv").style.display = "block";
        }
        else
        {
             document.getElementById("dadFeathertypeDiv").style.display = "none";
        }
    }
    
    var ranks = ["None", "Known", "Zeta+", "Arisen"];
    var breeds = ["Common", "Prairie"];
    var biorythmns = ["Diurnal", "Crepuscular", "Nocturnal"];
    var diets = ["Herbivore", "Omnivore", "Carnivore"];

    /////// AA RULES /////////
    var AaRules = 
    [
        ["aa", "aa", //Always passes aa
            [
                [1, 100, "aa"]
            ]   
        ],
        ["Aa", "aa", //1-40 pass Aa, 41-100 pass aa
            [
                [1, 40, "Aa"],
                [41, 100, "aa"]
            ]   
        ],
        ["Aa", "Aa", //Aa x Aa = 1-10 pass AA, 11-60 pass Aa, 61-100 pass aa
            [
                [1, 10, "AA"],
                [11, 60, "Aa"],
                [61, 100, "aa"]
            ]
        ],
        ["AA", "aa", //AA x aa = 1-5 pass AA, 6-50 pass Aa, 51-100 pass aa
            [
                [1, 5, "AA"],
                [6, 50, "Aa"],
                [51, 100, "aa"]
            ]
        ],
        ["AA", "Aa", //AA x Aa = 1-20 pass AA, 21-90 pass Aa, 91-100 pass aa
            [
                [1, 20, "AA"],
                [21, 90, "Aa"],
                [91, 100, "aa"]
            ]
        ],
        ["AA", "AA", //1-50 pass AA, 61-100 pass Aa // fixed to 51 -ES
            [
                [1, 50, "AA"],
                [51, 100, "Aa"]
            ]
        ]
    ];

    /////// EE RULES /////////
    var EeRules = 
    [
        ["ee", "ee", //Always passes ee
            [
                [1, 100, "ee"]
            ]   
        ],
        ["Ee", "ee", //1-40 pass Ee, 41-100 pass ee
            [
                [1, 40, "Ee"],
                [41, 100, "ee"]
            ]   
        ],
        ["Ee", "Ee", //Ee x Ee = 1-10 pass EE, 11-60 pass Ee, 61-100 pass ee
            [
                [1, 10, "EE"],
                [11, 60, "Ee"],
                [61, 100, "ee"]
            ]
        ],
        ["EE", "ee", //EE x ee = 1-5 pass EE, 6-50 pass Ee, 51-100 pass ee
            [
                [1, 5, "EE"],
                [6, 50, "Ee"],
                [51, 100, "ee"]
            ]
        ],
        ["EE", "Ee", //EE x Ee = 1-20 pass EE, 21-90 pass Ee, 91-100 pass ee
            [
                [1, 20, "EE"],
                [21, 90, "Ee"],
                [91, 100, "ee"]
            ]
        ],
        ["EE", "EE", //1-50 pass EE, 61-100 pass Ee // fixed to 51 -ES
            [
                [1, 50, "EE"],
                [51, 100, "Ee"]
            ]
        ]
    ];

   /////// OO RULES ////////

    var OoRules =  [

        ["oo", "oo", //Always passes oo
            [
                [1, 100, "oo"]
            ]   
        ],
        ["Oo", "oo", //Oo x oo = 1-15 pass Oo
            [
                [1, 15, "Oo"],
                [16, 100, "--"]
            ]   
        ],
        ["Oo", "Oo", //Oo x Oo = 1-2 pass OO, 3-25 pass Oo, 26-100 pass oo
            [
                [1, 2, "OO"],
                [3, 25, "Oo"],
                [26, 100, "oo"]
            ]   
        ],
        ["OO", "oo", //OO x oo = 1 pass OO, 2-20 pass Oo, 21-100 pass oo
            [
                [1, 1, "OO"],
                [2, 20, "Oo"],
                [21, 100, "oo"]
            ]   
        ],
        ["OO", "Oo", //OO x Oo = 1-5 pass OO, 6-40 pass Oo, 41-100 pass oo
            [
                [1, 5, "OO"],
                [6, 40, "Oo"],
                [21, 100, "oo"]
            ]   
        ]
    ];

     /////// XX RULES ////////

    var XxRules =  [

        ["xx", "xx", //Always passes xx
            [
                [1, 100, "xx"]
            ]   
        ],
        ["Xx", "xx", //Xx x xx = 1-15 pass Xx
            [
                [1, 15, "Xx"],
                [16, 100, "--"]
            ]   
        ],
        ["Xx", "Xx", //Xx x Xx = 1-2 pass XX, 3-25 pass Xx, 26-100 pass xx
            [
                [1, 2, "XX"],
                [3, 25, "Xx"],
                [26, 100, "xx"]
            ]   
        ],
        ["XX", "xx", //XX x xx = 1 pass XX, 2-20 pass Xx, 21-100 pass xx
            [
                [1, 1, "XX"],
                [2, 20, "Xx"],
                [21, 100, "xx"]
            ]   
        ],
        ["XX", "Xx", //XX x Xx = 1-5 pass XX, 6-40 pass Xx, 41-100 pass xx
            [
                [1, 5, "XX"],
                [6, 40, "Xx"],
                [21, 100, "xx"]
            ]   
        ]
    ];

    /////// XX OO RULES ////////

    var XxOoRules =  [

        ["Xx", "Oo", //Xx x Oo = 1-50 Xx, 51-100 Oo
            [
                [1, 50, "Xx"],
                [51, 100, "Oo"]
            ]   
        ],
        ["XX", "Oo", //XX x Oo = 1 dom XX, 2-75 Xx, 76-100 Oo
            [
                [1, 1, "XX"],
                [2, 75, "Xx"],
                [76, 100, "Xx"]
            ]   
        ],
        ["XX", "OO", //XX x OO = 1-10 dom XX, 11-50 Xx, 51-90 Oo, 91-100 dom OO
            [
                [1, 10, "XX"],
                [11, 50, "Xx"],
                [51, 90, "Oo"],
                [91, 100, "OO"]
            ]   
        ]
    ];

    /////// MARKINGS ////////

    // Rarities: 0 = Common, 1 = Uncommon, 2 = Rare

    var markings = [ 
        ["Blanket", "BlBl", "nBl", 0],
        ["Bubble", "BuBu", "nBU", 0],
        ["Collar", "CoCo", "nCo", 0],
        ["Dalmatian", "DaDa", "nDa", 0],
        ["Dun", "DD", "nD", 0],
        ["Flank", "FlFl", "nFl", 0],
        ["Gradient", "GrGr", "nGr", 0],
        ["Haze", "HzHz", "nHz", 0],
        ["Hood", "HH", "nH", 0],
        ["Pangare", "PgPg", "nPg", 0],
        ["Ringed", "RiRi", "nRi", 0],
        ["Sable", "SbSb", "nSb", 0],
        ["Shadow", "SwSw", "nSw", 0],
        ["Skunk", "SkSk", "nSk", 0],
        ["Smoke", "SmSm", "nSm", 0],
        ["Socks", "SoSo", "nSo", 0],
        ["Tailwind", "TwTw", "nTw", 0],
        ["Underbelly", "UU", "nU", 0],
        ["Viper", "VrVr", "nVr", 0],

        ["Candied", "CnCn", "nCn", 1],
        ["Laced", "LcLc", "nLc", 1],
        ["Magma", "MgMg", "nMg", 1],
        ["Marbled", "MbMb", "nMb", 1],
        ["Okapi", "OkOk", "nOk", 1],
        ["Painted", "PP", "nP", 1],
        ["Panda", "PaPa", "nPa", 1],
        ["Patched", "PaT", "nPaT", 1],
        ["Piebald", "PldPld", "nPld", 1],
        ["Ribs", "RbRb", "nRb", 1],
        ["Ripple", "RpRp", "nRp", 1],
        ["Rosette", "RoRo", "nRo", 1],
        ["Siamese", "SiSi", "nSi", 1],
        ["Snowflake", "SfSf", "nSf", 1],
        ["Striped", "StSt", "nSt", 1],
        ["Wax", "WxWx", "nWx", 1],

        ["Calico", "CaCa", "nCa", 2],
        ["Clown", "ClCl", "nCl", 2],
        ["Crested", "CrCr", "nCr", 2],
        ["Eidos", "EdEd", "nEd", 2],
        ["Heart", "HrHr", "nHr", 2],
        ["Inked", "InkInk", "nInk", 2],
        ["Iridescent", "IrIr", "nIr", 2],
        ["Koi", "KK", "nK", 2],
        ["Luminescent", "LuLu", "nLu", 2],
        ["Rune", "RnRn", "nRn", 2],
        ["Luminescent", "LuLu", "nLu", 2],
        ["Spotted", "SpSp", "nSp", 2],
        ["Wisp", "WiWi", "nWi", 2]
    ]

    /////// TAILS AND RUFFLES RULES ////////

    var tails = [
        ["None", "None"], // Visualize as Regular in dropdowns
        ["Fuzz", "Common"], 
        ["Silken", "Uncommon"],
        ["Short", "Rare"]
    ]

    var ruffles = [
        ["None", "None"],
        ["Muffed", "Common"], 
        ["Curly", "Uncommon"],
        ["Satin", "Rare"]
    ]

    var tailsRufflesRules =  [

        ["None", "None", //None x None = 1-100 None
            [
                [1, 100, "None"]
            ]   
        ],
        ["None", "Common", //None x C =  1-60 none, 61-90 common, 91-100 uncommon
            [
                [1, 60, "None"],
                [61, 90, "Common"],
                [91, 100, "Uncommon"]
            ]   
        ],
        ["None", "Uncommon", //None x UC = 1-70 none, 71-80 common, 81-99 uncommon, 100 rare
            [
                [1, 70, "None"],
                [71, 80, "Common"],
                [81, 99, "Uncommon"],
                [100, 100, "Rare"]
            ]   
        ],
        ["None", "Rare", //None x R = 1-90 none, 91-95 uncommon, 96-100 rare
            [
                [1, 90, "None"],
                [91, 95, "Uncommon"],
                [96, 100, "Rare"]
            ]   
        ],
        ["Common", "Uncommon", //C x UC = 1-40 none, 41-80 common, 81-99 uncommon, 100 rare
            [
                [1, 40, "None"],
                [41, 80, "Common"],
                [81, 99, "Uncommon"],
                [100, 100, "Rare"]
            ]   
        ],
        ["Common", "Rare", //C x R = 1-50 none, 51-70 common, 71-90 uncommon, 91-100 rare
            [
                [1, 50, "None"],
                [51, 70, "Common"],
                [71, 90, "Uncommon"],
                [91, 100, "Rare"]
            ]   
        ],
        ["Uncommon", "Rare", //UC x R = 1-60 none, 61-75 common, 76-85 uncommon, 86-100 rare
            [
                [1, 60, "None"],
                [61, 75, "Common"],
                [76, 85, "Uncommon"],
                [86, 100, "Rare"]
            ]   
        ],
        ["Common", "Common", //C x C = 1-20 none, 21-85 common, 86-100 uncommon
            [
                [1, 20, "None"],
                [21, 85, "Common"],
                [86, 100, "Uncommon"]
            ]
        ],
        ["Uncommon", "Uncommon", //UC x UC = 1-30 none, 31-40 common, 41-95 uncommon, 96-100 rare
            [
                [1, 30, "None"],
                [31, 40, "Common"],
                [41, 95, "Uncommon"],
                [96, 100, "Rare"]
            ]
        ],
        ["Rare", "Rare", //R x R = 1-50 none, 51-65 uncommon, 66-100 rare
            [
                [1, 50, "None"],
                [51, 65, "Uncommon"],
                [66, 100, "Rare"]
            ]
        ]
    ];

    /////// EARS RULES ////////

    var earsRules =  [

        ["Common", "Common",
            [
                [1, 100, "Common"]
            ]   
        ],
        ["Uncommon", "Uncommon",
            [
                [1, 100, "Uncommon"]
            ]   
        ],
        ["Rare", "Rare",
            [
                [1, 100, "Rare"]
            ]   
        ],
        ["Common", "Uncommon", //C x UC = 1-60 common, 61-100 uncommon
            [
                [1, 60, "Common"],
                [61, 100, "Uncommon"]
            ]   
        ],
        ["Common", "Rare", //C x R = 1-90 common, 91-100 rare
            [
                [1, 90, "Common"],
                [91, 100, "Rare"]
            ]   
        ],
        ["Uncommon", "Rare", //UC x R = 1-74 uncommon, 75-100 rare
            [
                [1, 74, "Uncommon"],
                [75, 100, "Rare"]
            ]
        ]
    ];

    ////// HORNS /////

    // Rarity: 0 = Common, 1 = Uncommon, 2 = Rare

    var horns = [

        ["Short",   0],
        ["Devil",   0],
        ["Rhino",   0],
        ["Kirin",   0],
        ["Para",    0],
        ["Curved",  0],

        ["Twin",    1],
        ["Ram",     1],
        ["Deer",    1],
        ["Dragonic",1],

        ["Bristle", 2],
        ["Fin",     2],
        ["Moose",   2],
        ["Unicorn", 2],
        ["Crown",   2]
    ];

     var hornsRules =  [

        ["Common", "Common",
            [
                [1, 100, "Common"]
            ]   
        ],
        ["Uncommon", "Uncommon",
            [
                [1, 100, "Uncommon"]
            ]   
        ],
        ["Rare", "Rare",
            [
                [1, 100, "Rare"]
            ]   
        ],
        ["Common", "Uncommon", //C x UC = 1-70 common, 71-100 uncommon
            [
                [1, 70, "Common"],
                [71, 100, "Uncommon"]
            ]   
        ],
        ["Common", "Rare", //C x R = 1-95 common, 96-100 rare
            [
                [1, 95, "Common"],
                [96, 100, "Rare"]
            ]   
        ],
        ["Uncommon", "Rare", //UC x R = 1-89 uncommon, 90-100 rare
            [
                [1, 89, "Uncommon"],
                [90, 100, "Rare"]
            ]
        ]
    ];

    ////// EARS /////

    // Rarity: 0 = Common, 1 = Uncommon, 2 = Rare

    var ears = [

        ["Regular",   0],
        ["Small",   0],
        ["High",   0],
        ["Tuft",   0],
        
        ["Floppy",    1],
        ["Folded",     1],
        ["Lynx",    1],

        ["Droop", 2],
        ["Elf",     2],
        ["Papillon",   2]
    ];

    ////// FEATHERTYPES //////

    var featherTypes = [
        ["Regular", "Common"],
        ["Dynasty", "Uncommon"],
        ["Emperor", "Rare"],
        ["Petal", "Rare"]
    ]

    /**
        C x UC = 1-65 common, 66-100 uncommon
        C x R = 1-90 common, 91-100 rare
        UC x R = 1-80 uncommon, 81-100 rare
    */

    var feathertypesRules =  [

        ["Common", "Common",
            [
                [1, 100, "Common"]
            ]   
        ],
        ["Uncommon", "Uncommon",
            [
                [1, 100, "Uncommon"]
            ]   
        ],
        ["Rare", "Rare",
            [
                [1, 100, "Rare"]
            ]   
        ],
        ["Common", "Uncommon", //C x UC = 1-65 common, 66-100 uncommon
            [
                [1, 65, "Common"],
                [66, 100, "Uncommon"]
            ]   
        ],
        ["Common", "Rare", //C x R = 1-90 common, 91-100 rare
            [
                [1, 90, "Common"],
                [91, 100, "Rare"]
            ]   
        ],
        ["Uncommon", "Rare", //UC x R = 1-80 uncommon, 81-100 rare
            [
                [1, 80, "Uncommon"],
                [81, 100, "Rare"]
            ]
        ]
    ];



    var commonMarkingsRules =  [

        ["nU", "--", //nU x -- = 1-40 to pass
            [
                [1, 40, "nU"],
                [41, 100, "--"]
            ]   
        ],
        ["UU", "--", //UU x -- = 1-5 pass dominant, 1-50 pass non dominant, 51-100 not pass
            [
                [1, 5, "UU"],
                [6, 50, "nU"], // fix to 6 - ES
                [51, 100, "--"]
            ]   
        ],
        ["nU", "nU", //1-15 to pass dominant, 16-70 pass non dominant, 71-100 not pass
            [
                [1, 15, "UU"],
                [16, 70, "nU"],
                [71, 100, "--"]
            ]   
        ],
        ["nU", "UU", //nU x UU = 1-40 to pass dominant, 41-90 non dominant, 91-100 not pass
            [
                [1, 40, "UU"],
                [41, 90, "nU"],
                [91, 100, "--"]
            ]   
        ],
        ["UU", "UU", //UU x UU = 1-60 pass dominant, 61-100 non dominant
            [
                [1, 60, "UU"],
                [61, 100, "nU"]
            ]
        ]
    ];

    var uncommonMarkingsRules = [

        ["nU", "--", //nU x -- = 1-20 to pass
            [
                [1, 20, "nU"],
                [21, 100, "--"]
            ]   
        ],
        ["UU", "--", //UU x -- = 1-2 pass dominant, 4-35 pass non dominant, 36-100 not pass
            [
                [1, 2, "UU"],
                [3, 35, "nU"], // FIXED TO 3 -ES
                [36, 100, "--"]
            ]
        ],
        ["nU", "nU", //nU x nU = 1-10 to pass dominant, 11-45 pass non dominant, 46-100 not pass
            [
                [1, 10, "UU"],
                [11, 45, "nU"],
                [46, 100, "--"]
            ]
        ],
        ["nU", "UU", //nU x UU = 1-15 to pass dominant, 16-60 non dominant, 61-100 not pass
            [
                [1, 15, "UU"],
                [16, 60, "nU"],
                [61, 100, "--"]
            ]
        ],
        ["UU", "UU", //UU x UU = 1-20 pass dominant, 21-85 non dominant, 86-100 not pass
            [
                [1, 20, "UU"],
                [21, 85, "nU"],
                [86, 100, "--"]
            ]
        ]
    ];

    var rareMarkingsRules = [

        ["nU", "--", //nU x -- = 1-10 to pass
            [
                [1, 10, "nU"],
                [11, 100, "--"]
            ]   
        ],
        ["UU", "--", //UU x -- = 1-15 pass non dominant, 21-100 not pass
            [
                [1, 15, "nU"],
                [21, 100, "--"]
            ]
        ],
        ["nU", "nU", //nU x nU = 1-2 to pass dominant, 3-25 pass non dominant, 26-100 not pass
            [
                [1, 2, "UU"],
                [3, 25, "nU"],
                [26, 100, "--"]
            ]
        ],
        ["nU", "UU", //nU x UU = 1-5 to pass dominant, 11-35 non dominant, 46-100 not pass
            [
                [1, 5, "UU"],
                [6, 35, "nU"], // changed to 6-35 -ES
                [36, 100, "--"] // changed to 36 -ES
            ]
        ],
        ["UU", "UU", //UU x UU = 1-10 pass dominant, 26-60 non dominant, 61-100 not pass
            [
                [1, 10, "UU"],
                [11, 60, "nU"], // FIXED TO 11 -ES
                [61, 100, "--"]
            ]
        ]
    ];

    function getMarkingRarity(markingType)
    {
        var rarities  = ["Common", "Uncommon", "Rare"]; // helper array to help use the number coded rarities

        // Find markings rarity
        for(var i = 0; i < markings.length; i++)
        {
            //console.log("Checking " + markings[i][1] + " and " + markings[i][2] + " " + markingType);

            if(markings[i][1] == markingType || markings[i][2] == markingType)
            {
                //console.log("Marking rarity is " +  rarities[markings[i][3]]);
                return rarities[markings[i][3]];
            }
        }

        console.log("ERROR! Could not find Markings rarity");

        return "ERROR! Could not find Markings rarity";
    }

    function contains(a, obj) 
    {
        for (var i = 0; i < a.length; i++) {
            if (a[i] === obj) {
                return true;
            }
        }

        return false;
    }

    /**
        var markings = [ 
        ["Blanket", "Blbl", "nBl", 0],
        ["Bubble", "BuBu", "nBU", 0],
        ["Collar", "CoCo", "nCo", 0],
        ["Dalmatian", "DaDa", "nDa", 0], */


    /**
    * returns UU, nU or -- depending on the marking
    */
    function getMarkingDom(marking)
    {
        if(marking == "--")
        {
            return "--";
        }

        for(i = 0; i < markings.length; i++)
        {
            //console.log("DOM CHECK: " + markings[i][1] + " AND " + marking);

            if(markings[i][1] == marking)
            {
                //console.log("Found match!: " + markings[i][1] + " AND " + marking);


                return "UU";
            }

            //console.log("DOM CHECK: " + markings[i][2] + " AND " + marking);

            if(markings[i][2] == marking)
            {
                 //console.log("Found match!: " + markings[i][2] + " AND " + marking);

                return "nU";
            }


        }

        console.log("ERROR! could not find marking dom " + marking)

        return undefined;
    }

    function getMarking(marking1, marking2, rules)
    {
        console.log(typeof(marking1));
        console.log(typeof(marking2));

        console.log("Marking1: " + marking1);
        console.log("Marking 2: " + marking2);

        var marking1Dom = getMarkingDom(marking1);
        var marking2Dom = getMarkingDom(marking2);

        //console.log(marking1Dom);
        //console.log(marking2Dom);

        for(var i = 0; i < rules.length; i++) {

            console.log("Checking if " +  rules[i][0] + " matches " + marking1Dom + " and " + rules[i][1] + " matches " + marking2Dom);

            if ( rules[i][0] == marking1Dom && rules[i][1] == marking2Dom || 
                 rules[i][0] == marking2Dom && rules[i][1] == marking1Dom )
            {
                 console.log("Match found! Let's roll!");

                var roll = RollMe(1, 100);
                logRoll(marking1 + " and " + marking2 + " roll: " + roll);
                //var roll = 5;
                console.log("MatchFound roll: " + roll);

                for(var j = 0; j < rules[i][2].length; j++)
                {
                    console.log("checking if " + roll + " is bigger or same as " + rules[i][2][j][0] +  " and" + 
                    "if " + roll + " is smaller or same as " + rules[i][2][j][1]);

                    if(roll >= rules[i][2][j][0] && roll <= rules[i][2][j][1]) // if roll is within the written roll limits
                    {
                        console.log(" is within roll limits! ");
                        var dom = rules[i][2][j][2]; // UU, nU, --

                        console.log(" dom:  " + dom);
                        console.log(" marking1Dom:  " + marking1Dom);
                        console.log(" marking2Dom:  " + marking2Dom);

                        if(dom == marking1Dom)
                        {
                            console.log(marking1);
                            return marking1.toString();
                        }                            
                        else if (dom == marking2Dom)
                        {
                             console.log(marking2);
                             return marking2.toString();
                        }      
                        else if (dom != "--")
                        {
                            console.log(" marking1:  " + marking1);
                            console.log(" marking2:  " + marking2);

                            if(marking1 != "--")
                            {
                                return getSameTypeMarking(marking1);
                            }

                            if(marking2 != "--")
                            {
                                return getMarkingIfSameType(marking2);
                            }

                            console.log("ERROR, dom was not -- but found no vastaMarking");
                            return undefined;
                        }                         
                        else
                        {
                            console.log("--");
                            return "--";
                        }
                           
                    } 
                }

                break;
            }
        }

        console.log("ERROR! Did not find a match for " + marking1 + " and " + marking2)
    }

    /**
    * Compares the target array and general array and returns true if target has a marking of the same type.
    */
    function containsSameTypeMarking(marking, target)
    {
        for(var i = 0; i < target.length; i++)
        {
            if(marking == target[i]) // target array has the exact same type, no need to check for similar type
                return true;

            for(var j = 0; j < markings.length; j++)
            {
                if( (markings[j][1] == marking || markings[j][2] == marking) )
                {
                    if(target[i] == markings[j][1] || target[i] == markings[j][2]) 
                    {
                        // We have a found a marking of similar type!
                        return true;
                    }
                } 
            }
        }

        return false;
    }

    /** 
    * Finds the vastaMarking from markings.
    */
    function getSameTypeMarking(marking)
    {
        var markingOtherType = ""; // Marking's

        for(var m = 0; m < markings.length; m++)
        {
            if( (markings[m][1] == marking || markings[m][2] == marking) )
            {
                if(marking == markings[m][1]) 
                {
                    markingOtherType = markings[m][2];
                }
                else if(marking == markings[m][2]) 
                {
                    markingOtherType = markings[m][1];
                }

                return markingOtherType;
            }
        }

        console.log("Error! Could not find same type of marking: " + marking);
        return undefined;
    }

    /** 
    * Returns target's marking if it is the same type as the marking. If not, returns "--";
    */
    function getMarkingIfSameType(marking, target)
    {
        var markingOtherType = ""; // Marking's

        for(var m = 0; m < markings.length; m++)
        {
            //console.log("Checking " + markings[m][1] + " and " + marking);
            //console.log("Checking " + markings[m][2] + " and " + marking);

            if( (markings[m][1] == marking || markings[m][2] == marking) )
            {
                console.log("FOUND MATCH! " + marking);

                if(marking == markings[m][1]) 
                {
                    console.log("it's this one! " + marking);
                    markingOtherType = markings[m][2];
                }
                else if(marking == markings[m][2]) 
                {
                    console.log("it's this one! " + marking);
                    markingOtherType = markings[m][1];
                }

                break;
            }
        }

        for(var n = 0; n < target.length; n++)
        {
            console.log("Checking " + target[n] + " and " + marking + " " + n);

            if(target[n] == marking)
            {
                console.log("match found: " + target);

                return target[n];
            }
            else if(target[n] == markingOtherType)
            {
                console.log("match found: " + markingOtherType);

                return target[n];
            }
        }

        console.log("no match found");

        return "--";
    }

    function calculateMarkingssss(mumMarkings, dadMarkings)
    {
        var markingsStr = "";

        console.log("MumMarkings length: " + mumMarkings.length);

        // for(i = 0; i < mumMarkings.length; i++)
        // {
        //     console.log(mumMarkings[i]);
        // }

        var dadMatchedMarkingsOfSameType = []; // Markings the dad has that are same type as the mum's 

        for(var i = 0; i < mumMarkings.length; i++)
        {
            console.log("Checking before: " + mumMarkings[i]);

            console.log(i); 
            
            var vastaMarking = getMarkingIfSameType(mumMarkings[i], dadMarkings);

            console.log(i);

            console.log("Checking after: " + mumMarkings[i]);

            var mumMarking = "";
            mumMarking = mumMarkings[i];

            //var markingRarity = getMarkingRarity(mumMarking);

            var rarities  = ["Common", "Uncommon", "Rare"]; // helper array to help use the number coded rarities
            var markingRarity = "";

            // Find markings rarity
            for(var j = 0; j < markings.length; j++)
            {
                //console.log("Checking " + markings[j][1] + " and " + markings[j][2] + " " + mumMarking);

                if(markings[j][1] == mumMarkings[i] || markings[j][2] == mumMarkings[i])
                {
                    console.log("Marking rarity is " +  rarities[markings[j][3]]);
                    markingRarity = rarities[markings[j][3]];
                    break;
                }
            }            

            //console.log("Checking: " + mumMarkings[i]);

            var marking = "";

            if(markingRarity == "Common") 
            { 
                marking = getMarking(mumMarkings[i], vastaMarking, commonMarkingsRules); 
            }
            else if (markingRarity == "Uncommon" ) 
            { 
                marking = getMarking(mumMarkings[i], vastaMarking, uncommonMarkingsRules);
            }
            else 
            { 
                marking = getMarking(mumMarkings[i], vastaMarking, rareMarkingsRules); 
            }

            console.log("Marking: " + marking);

            if(marking != "--")
            {
                console.log(markingsStr);

                markingsStr += marking + "/";
                dadMatchedMarkingsOfSameType[dadMatchedMarkingsOfSameType.length] = vastaMarking;
/*
                index = dadMarkings.indexOf(marking); // Remove found marking of same type    
                if (index > -1) {
                    dadMarkings.splice(index, 1);
                }*/
            }
        }

        console.log("DadMarkings length: " + dadMarkings.length);

        for(var i = 0; i < dadMarkings.length; i++)
        {
            console.log("Going through dadMarking " + dadMarkings[i]);

            if(contains(dadMatchedMarkingsOfSameType, dadMarkings[i])) // We have already found a matching marking, don't go through it again
            {
                console.log("We have checked " + dadMarkings[i] + " already, continuing to next loop");
                continue;
            }

            console.log("Checking DAD before: " + dadMarkings[i]);

            console.log(i); 
            
            var vastaMarking = getMarkingIfSameType(dadMarkings[i], mumMarkings);

            console.log(i);

            console.log("Checking after: " + dadMarkings[i]);

            var dadMarking = "";
            dadMarking = dadMarkings[i];

            //var markingRarity = getMarkingRarity(mumMarking);

            var rarities  = ["Common", "Uncommon", "Rare"]; // helper array to help use the number coded rarities
            var markingRarity = "";

            // Find markings rarity
            for(var j = 0; j < markings.length; j++)
            {
                //console.log("Checking " + markings[j][1] + " and " + markings[j][2] + " " + mumMarking);

                if(markings[j][1] == dadMarkings[i] || markings[j][2] == dadMarkings[i])
                {
                    console.log("Marking rarity is " +  rarities[markings[j][3]]);
                    markingRarity = rarities[markings[j][3]];
                    break;
                }
            }            

            //console.log("Checking: " + mumMarkings[i]);

            var marking = "";

            if(markingRarity == "Common") 
            { 
                marking = getMarking(dadMarkings[i], vastaMarking, commonMarkingsRules); 
            }
            else if (markingRarity == "Uncommon" ) 
            { 
                marking = getMarking(dadMarkings[i], vastaMarking, uncommonMarkingsRules);
            }
            else 
            { 
                marking = getMarking(dadMarkings[i], vastaMarking, rareMarkingsRules); 
            }

            console.log("Marking: " + marking);

            if(marking != "--")
            {
                console.log(markingsStr);

                markingsStr += marking + "/";
            }
        }

        if(markingsStr.length > 0)
        {
            if (markingsStr[markingsStr.length-1] == "/")
                markingsStr = markingsStr.substring(0, markingsStr.length - 1);
        }

        console.log(markingsStr);  

        return markingsStr;
    }

    /**
    * Returns found markings in an array.
    */
    function getMarkings(genos)
    {
        var markingsAr = [];

        for(var i = 0; i < genos.length; i++)
        {
            if(genos[i].toLowerCase() != "aa" 
            && genos[i].toLowerCase() != "xx"
            && genos[i].toLowerCase() != "oo"
            && genos[i].toLowerCase() != "ee")
            {
                markingsAr[markingsAr.length] = genos[i];
            }
        }

        return markingsAr;
    }

    function getXoColor(mumGenos, dadGenos)
    {
         var XoColor = "";

         if(mumGenos.length <= 2 || dadGenos.length <= 2)
            return XoColor;

        var mumXo = "";

        if((mumGenos[2].toLowerCase() == "xx" || mumGenos[2].toLowerCase() == "oo"))
        {
            mumXo = mumGenos[2];
        }

        var dadXo = "";

        if((dadGenos[2].toLowerCase() == "xx" || dadGenos[2].toLowerCase() == "oo"))
        {
            dadXo = dadGenos[2];
        }

        console.log("mumXo: " + mumXo + " dadXo: " + dadXo);
        console.log()

        if(mumXo.toLowerCase() == "xx" && dadXo.toLowerCase() == "xx")
        {
            XoColor = calculateBaseColor(mumXo, dadXo, XxRules);
        }
        else if(mumXo.toLowerCase() == "oo" && dadXo.toLowerCase() == "oo")
        {
            XoColor = calculateBaseColor(mumXo, dadXo, OoRules);
        }
        else if((mumXo.toLowerCase() == "xx" && dadXo.toLowerCase() == "oo") || 
                (dadXo.toLowerCase() == "xx" && mumXo.toLowerCase() == "oo"))
        {
            XoColor = calculateBaseColor(mumXo, dadXo, XxOoRules);
        }

        if(XoColor == undefined)
            XoColor = "--";

        return XoColor;
    }

    function getFeathertypeRarity(feathertype)
    {
        console.log("Get feathertype rarity! " + feathertype);

        for(var i = 0; i < featherTypes.length; i++)
        {
            console.log("Checking: " + featherTypes[i][0]);

            if(feathertype == featherTypes[i][0])
                return featherTypes[i][1];
        }
    }

    function calculateFeathertype(mumFeathertype, dadFeathertype, rules)
    {
        console.log("Calculate feather type!");

        console.log(mumFeathertype);
        console.log(dadFeathertype);

        var mumFeathertypeRarity = getFeathertypeRarity(mumFeathertype);
        var dadFeathertypeRarity = getFeathertypeRarity(dadFeathertype);

        console.log("mumFeathertypeRarity: " + mumFeathertypeRarity);
        console.log("dadFeathertypeRarity: " + dadFeathertypeRarity);

        for(var i = 0; i < rules.length; i++)
        {
            if((rules[i][0] == mumFeathertypeRarity && rules[i][1] == dadFeathertypeRarity) || (rules[i][0] == dadFeathertypeRarity && rules[i][1] == mumFeathertypeRarity))
            {
                var roll = RollMe(1, 100);
                logRoll("Feathertype roll: " + roll);

                for(j = 0; j < rules[i][2].length; j++)
                {
                    if(roll >= rules[i][2][j][0] && roll <= rules[i][2][j][1]) // if roll is within the written roll limits
                    {
                        var rarity = rules[i][2][j][2]; // Uncommon, Rare.. etc

                        if(mumFeathertypeRarity == dadFeathertypeRarity)
                        {
                            var sameRarityRoll = RollMe(1, 2);
                            logRoll("Feathertypes are the same rarity. Rolling which parent we choose for feathertype (1= mum, 2= dad): " + sameRarityRoll);

                            if(sameRarityRoll == 1)
                                return mumFeathertype;
                            else
                                return dadFeathertype;
                        }

                        if(rarity == mumFeathertypeRarity)
                            return mumFeathertype;
                        else 
                            return dadFeathertype;
                    } 
                }

                break;
            }
        }


    }

    function accepts(myRank, otherRank, myMutations, otherMutations, gender, otherGender)
    {
        for(var i = 0; i < myMutations.length; i++)
        {
            console.log(myMutations[i]);
        }

        var result = [false, "Mating was not successful for an unknown reason."];

        if(document.getElementById('mumStarter').checked || document.getElementById('dadStarter').checked)
        {
            logRoll("At least one parent is a starter. Do not refuse mating.");

            result = [true, ""];
            return result;
        }

        if(contains(myMutations, "Double horns") || contains(otherMutations, "Double horns"))
        {
            logRoll("Parent has double horns. Accept mating.")
            result = [true, ""];
        }
        
        if(contains(otherMutations, "Hornless"))
        {
            var roll = RollMe(1,2);
            logRoll("Roll refuse mating due to Hornless mutation (1-2 (1 accepts)): " + roll)
            if(roll == 1)
            {
                result = [true, ""];
            }
            else
            {
                result = [false, "Due to the " + otherGender + " is Hornless, the " + gender + " refused to mate with them, resulting in an empty nest."];
                return result;
            }               
        }
        
        if(contains(myMutations, "Miniature"))
        {
            if(!contains(otherMutations, "Miniature"))
            {
                 result = [false, "Due to the " + otherGender + " is not a Miniature as the " + gender + " is, " 
                 + "the " + gender + " refused to mate with them, resulting in an empty nest."];

                 return result;
            }
        }
        
        if(contains(otherMutations, "Eyeless"))
        {
            var roll = RollMe(1,4);
            logRoll("Roll refuse mating due to Eyeless mutation (1-4 (1 refuses)): " + roll)
            if(roll == 1)
            {
                result = [false, "The " + gender + " refused to mate with the " + otherGender + " due to it is Eyeless!"];
                return result;
            }
            else
            {
                 result = [true, ""];
            }
        }
        

        if(myRank == "Arisen" || otherRank == "Arisen")
        {
            result = [true, ""];
        }
        else if(myRank == "Zeta+")         
        {
            if(otherRank == "Zeta+" || otherRank == "Arisen")
            {
                 result = [true, ""];
            }
            else 
                result = [false, "Refuse mating, rank too low for Zeta+."];       
        }
        else if(otherRank == "None")
        {
            var roll = RollMe(1,10);
            logRoll("Roll refuse mating due to None rank (1-10 (1 refuses)): " + roll);
            if(roll == 1)
            {
                 result = [false, "Due to the mate's low rank, " + gender + " refused mating with the " + otherGender + "."];
            }
            else
            {
                 result = [true, ""];
            }           
        }

        return result;
    }

    //// BIORYTHMN RULES ////
    var biorythmnRules = [

        ["Crepuscular", "Crepuscular", // Cre x Cre = 1-100
            [
                [1, 100, "Crepuscular"]
            ]
        ],
        ["Diurnal", "Diurnal", // Di x Di = 1-100
            [
                [1, 100, "Diurnal"]
            ]
        ],
        ["Nocturnal", "Nocturnal", // Noc x Noc = 1-100
            [
                [1, 100, "Nocturnal"]
            ]
        ],
        ["Diurnal", "Nocturnal",  // Di x Noc = 1-50 diurnal, 51-75 crepuscular, 76-100 Nocturnal
            [
                [1, 50, "Diurnal"],
                [51, 75, "Crepuscular"],
                [76, 100, "Nocturnal"]
            ]
        ],        
        ["Diurnal", "Crepuscular", // Di x Cre = 1-65 diurnal, 66-95 crepuscular, 96-100 Nocturnal
            [
                [1, 65, "Diurnal"],
                [66, 95, "Crepuscular"],
                [96, 100, "Nocturnal"]
            ]
        ],
        ["Crepuscular", "Nocturnal", // Cre x Noc = 1-30 diurnal, 31-60 crepuscular, 61-100 Nocturnal
            [
                [1, 30, "Diurnal"],
                [31, 60, "Crepuscular"],
                [61, 100, "Nocturnal"]
            ]
        ]
    ]

    //// DIET RULES ////
    var dietRules = [

        ["Herbivore", "Herbivore", // Herb x Herb = 1-100
            [
                [1, 100, "Herbivore"]
            ]
        ],
        ["Omnivore", "Omnivore", // Omni x Omni = 1-100
            [
                [1, 100, "Omnivore"]
            ]
        ],
        ["Carnivore", "Carnivore", // Carni x Carni = 1-100
            [
                [1, 100, "Carnivore"]
            ]
        ],
        ["Herbivore", "Omnivore",  // Herb x Omni = 1-30 herb, 31-75 omni, 76-100 carni
            [
                [1, 30, "Herbivore"],
                [31, 75, "Omnivore"],
                [76, 100, "Carnivore"]
            ]
        ],        
        ["Herbivore", "Carnivore", // Herb x Carni = 1-15 herb, 16-60 omni, 61-100 carni
            [
                [1, 15, "Herbivore"],
                [16, 60, "Omnivore"],
                [61, 100, "Carnivore"]
            ]
        ],
        ["Omnivore", "Carnivore", // Omni x Carni = 1-5 herb, 6-60 omni, 61-100 carni
            [
                [1, 5, "Herbivore"],
                [6, 60, "Omnivore"],
                [61, 100, "Carnivore"]
            ]
        ]
    ]

     //// RANDOM MUTATION RULES ////
    var randomMutationRules = [

        [1, 1, // Epic
            [
                ["Chimera", 
                    [
                        ["none", 0]
                    ]
                ]
            ]
        ],
        [2, 50, // Common
            [
                ["Heterochromia", 
                    [
                        ["none", 0]]
                    ],
                ["Whiskers",
                    [
                        ["none", 0]
                    ]
                ]
            ]
        ],
        [51, 70, // Uncommon
            [
                ["Saber", 
                    [
                        ["ATK", 1]
                    ]
                ],
                ["Tusks", 
                    [
                        ["ATK", 1]
                    ]
                ],
                ["Albino", 
                    [
                        ["none", 0]
                    ]
                ]
            ]
        ],
        [75, 90, // Rare
            [
               ["Double horns", 
                    [
                        ["none", 0]
                    ]
                ],
               ["Sphynx",
                    [
                        ["DEF", -1]
                    ]
                ]
            ]
        ],        
        [91, 100, // Flawed
            [
                ["Hornless", [
                        ["none", 0]
                    ]],
                ["Blind/Deaf", 
                    [
                        ["RANDOM", -1],
                        ["RANDOM", -1]
                    ]
                ],
                ["Miniature", [
                        ["none", 0]
                    ]],
                ["Scales", [
                        ["none", 0]
                    ]]
            ]
        ]
    ]

    // INBRED MUTATION RULES
     var inbredMutationRules = [

        ["Crippled", 
            [
                ["ATK", -1],
                ["DEF", -1],
                ["SPD", -1]
            ]
        ],
        ["Eyeless",
            [
                ["RANDOM", -1],
                ["RANDOM", -1]
            ]
        ],
        ["Amputated",
            [
                ["SPD", -2]
            ]
        ],
        ["Spider",
            [
                 ["none", 0]
            ]
        ],        
        ["Orthrus",
            [
                ["ATK", 1],
                ["SPD", -1]
            ]
        ],
    ]

    function getInbredMutation()
    {
        console.log("GET INBRED MUTATION");

        var roll =RollMe(0, inbredMutationRules.length-1);
        //var roll = 1;
        logRoll("Inbred mutation 1-" + inbredMutationRules.length-1 + " roll: " + roll);

        return inbredMutationRules[roll][0];
    }

    function getFlawedOrInbredMutation()
    {
        console.log("GET FLAWED OR INBRED MUTATION");

        var totalFlawed = randomMutationRules[4].length;
        var totalInbred = inbredMutationRules.length;

        var total = totalFlawed+totalInbred;

        var roll = RollMe(0, total-1);

        console.log("Flawed or inbred mutation roll: " + roll);

        if(roll < randomMutationRules[4].length)
        {
            console.log("Returning " + randomMutationRules[4][2][roll][0]);
            return randomMutationRules[4][2][roll][0];
        }
        else
        {
            console.log("Returning " + inbredMutationRules[total-1-roll][0]);
            return inbredMutationRules[total-1-roll][0];
        }
    }

    function getAnyMutation()
    {
        console.log("GET ANY MUTATION");

        var totalRandom = 0;

        for(var i = 0; i < randomMutationRules.length; i++)
        {
            totalRandom += randomMutationRules[i][2].length;   
        }

        var totalInbred = inbredMutationRules.length;

        var total = totalRandom+totalInbred;

        var roll = RollMe(0, total-1);

        console.log("Any mutation roll: " + roll);

        if(roll < totalRandom)
        {
            console.log("Get random mutation!");
            return getRandomMutation();
        }
        else
        {
            console.log("Get inbred mutation!");
            return getInbredMutation();
        }
    }

    function getRandomMutation()
    {
        console.log("GET RANDOM MUTATION");

        var randomMutRoll =RollMe(1,100);
        //var randomMutRoll = 91;
        console.log("Random mutation passes, rarity roll: " + randomMutRoll);
        logRoll("Random mutation passes, rarity roll: " + randomMutRoll);

        for(var i = 0; i < randomMutationRules.length; i++)
        {
            if(randomMutRoll >= randomMutationRules[i][0] && randomMutRoll <= randomMutationRules[i][1])
            {
                var numberRoll = RollMe(0, randomMutationRules[i][2].length-1);
                //var numberRoll = 1;
                console.log("Which mutation roll " + numberRoll);
                logRoll("Which mutation roll: " + numberRoll);
                console.log(randomMutationRules[i][2][numberRoll][0]);
                return randomMutationRules[i][2][numberRoll][0];
            }
        }

        return "";
    }

    function getMutationSkillPointEffect(mutation)
    {
        var skillPointEffects = [0, 0, 0]; // ATK, DEF, SPD

        for(var i = 0; i < randomMutationRules.length; i++) // Go through each random mutation type
        {
            console.log("randomMutationRules.length: " + randomMutationRules.length);
            console.log("randomMutationRules[i].length: " + randomMutationRules[i].length);

            for(var j = 0; j < randomMutationRules[i][2].length; j++) // Go through each mutation
            {
                if(randomMutationRules[i][2][j][0] == mutation)
                {
                    console.log("match found");

                    for(var k = 0; k < randomMutationRules[i][2][j][1].length; k++) // Go through mutation's skill points
                    {
                        console.log("Checking if " + randomMutationRules[i][2][j][1][k][0] + " is ATK");

                        if(randomMutationRules[i][2][j][1][k][0] == "ATK")
                        {
                            skillPointEffects[0] += randomMutationRules[i][2][j][1][k][1];
                        }
                        else if(randomMutationRules[i][2][j][1][k][0] == "DEF")
                        {
                            skillPointEffects[1] += randomMutationRules[i][2][j][1][k][1];
                        }
                        else if(randomMutationRules[i][2][j][1][k][0] == "SPD")
                        {
                            skillPointEffects[2] += randomMutationRules[i][2][j][1][k][1];
                        }
                        else if(randomMutationRules[i][2][j][1][k][0] == "RANDOM")
                        {
                           skillPointEffects[RollMe(0,2)] += randomMutationRules[i][2][j][1][k][1];
                        }
                    }

                    break;
                }
            }
        }

        for(var i = 0; i < inbredMutationRules.length; i++) // Go through each inbred mutation
        {
            //console.log("inbredMutationRules.length: " + inbredMutationRules.length);
            //console.log("inbredMutationRules[i].length: " + inbredMutationRules[i].length);

            if(inbredMutationRules[i][0] == mutation)
            {
                for(var k = 0; k < inbredMutationRules[i][1].length; k++) // Go through mutation's skill points
                {
                    for(var m = 0; m < inbredMutationRules[i][1][k].length; m++)
                    {
                        if(inbredMutationRules[i][1][k][m] == "ATK")
                        {
                            skillPointEffects[0] += inbredMutationRules[i][1][k][1];
                        }
                        else if(inbredMutationRules[i][1][k][m] == "DEF")
                        {
                            skillPointEffects[1] += inbredMutationRules[i][1][k][1];
                        }
                        else if(inbredMutationRules[i][1][k][m] == "SPD")
                        {
                            skillPointEffects[2] += inbredMutationRules[i][1][k][1];
                        }
                        else if(inbredMutationRules[i][1][k][m] == "RANDOM")
                        {
                            skillPointEffects[RollMe(0,2)] += inbredMutationRules[i][1][k][1];
                        }
                    }
                }

                break;
            }
        }

        console.log("returning " + skillPointEffects);

        return skillPointEffects;
    }

    function getNestSize(mumRank, dadRank, mumMut, dadMut, isInbred)
    {
        var nestSize = 0; 

        if(document.getElementById('mumStarter').checked || document.getElementById('dadStarter').checked)
        {
            logRoll("At least one parent is a starter. Nest size 2 eggs.");

            return 2;
        }

        if(isInbred && (mumRank == "Zeta+" && dadRank == "Zeta+")) // Don't care about inbreeding if both parents are Zeta+.
        {
            var roll = RollMe(1,3);

            logRoll("Inbred but parents are Zeta+. Nest size roll (1-3): " + roll);
            return roll;
        }

        if(contains(mumMut, "Hornless") || contains(dadMut, "Hornless"))
        {
            if(nestSize > 2)
            {
                logRoll("Parent has mutation Hornless, reduce nestSize to 2 from " + nestSize);
                nestSize = 2;
            }        
        }
        
        if(contains(mumMut, "Miniature") && contains(dadMut, "Miniature"))
        {
            var roll = RollMe(1,4);
            logRoll("Miniature x Miniature 25% chance of 2 eggs: (1-4, 1 pass): " + roll);

            if(roll == 1)
                nestSize = 2;
            else
                nestSize = 1;
        }

        if(contains(mumMut, "Crippled") || contains(dadMut, "Crippled"))
        {
            var roll = RollMe(1,100);
            logRoll("Parent is crippled. Roll 1-100 for failed nest: " + roll);

            if(roll <= 40)
            {
                nestSize = 0;
                return nestSize;
            }
        }

        if(mumRank == "Arisen" || dadRank == "Arisen")
        {
            var roll = RollMe(1,3);

            logRoll("Nest size roll: " + roll);
            var extraEggRoll = 0;

            if(contains(mumMut, "Double horns") || contains(dadMut, "Double horns"))
            {
                extraEggRoll = RollMe(1,5);
                logRoll("Extra egg roll (double horns 1-5): " + extraEggRoll);
            }
            else
            {
                var extraEggRoll = RollMe(1,10);
                logRoll("Extra egg roll (1-10): " + extraEggRoll);
            }

            if(extraEggRoll == 1)
            {
                roll += 1;
                console.log("Extra egg added to the nest!")
            }

            nestSize = roll;
        }
        else if(mumRank == "Zeta+" && dadRank == "Zeta+")   
        {
           var roll = RollMe(1,3);
           logRoll("Nest size roll: " + roll);
           nestSize = roll;
        }
        else if(mumRank == "None" || mumRank == "Known")
        {
            var roll = RollMe(0,3);
            logRoll("Nest size roll: " + roll);
            nestSize = roll;
        }

        if(contains(mumMut, "Amputated") || contains(dadMut, "Amputated"))
        {
            if(nestSize > 2)
                nestSize = 2;
        }

        return nestSize;
    }

    function calculateSkillpoints(parentPoints)
    {
        var skillPoints = 0;

        if(parentPoints >= 10)
        {
            var roll =RollMe(1,10);
            if(roll == 1)
                skillPoints = 1;

            var afterTen = parentPoints - 10;
            var jakoTasaTulos = afterTen/5;

            for(var i = 0; i < jakoTasaTulos; i++)
            {
                var sRoll =RollMe(1,10);
                if(sRoll == 1)
                    skillPoints += 1;
            }
        }

       return skillPoints;
    }

    function hasDuplicates(ar)
    {
        for(var i = 0; i < ar.length; i++)
        {
            for(var j = 0; j < ar.length; j++)
            {
                if(i != j && ar[i] == ar[j])
                    return true;
            }
        }

        return false;
    }

    // Get a guaranteed unique mutation that does not exist in the array
    function getUniqueFlawedOrInbredMutation(ar)
    {
        var mutation = getFlawedOrInbredMutation();

        if(contains(ar, mutation))
        {
            return getUniqueFlawedOrInbredMutation(ar);
        }
        else
        {
            return getU
        }
    }

    function getMutations()
    {
        var mutations = [];
        var mutationStr = "";

        var randomMutRoll = RollMe(1,10);

        if(randomMutRoll == 1)
        {
            mutations[0] = getRandomMutation();
        }

        if(document.getElementById('inbred').checked)
        {
            var inbredMutation = getInbredMutation();
            mutations[mutations.length] = inbredMutation;

            for(var i = 0; i < 100; i++)
            {
                var mut = getFlawedOrInbredMutation();
                if(!contains(mutations, mut))
                {
                    mutations[mutations.length] = mut;
                    break;
                }                
            }

            // Extra roll 15%.
            var roll = RollMe(1,100);
            logRoll("Rolling for extra mutation for inbred (1-100)" + roll);
            if(roll <= 15)
            {
                for(var i = 0; i < 100; i++)
                {
                    var mut = getAnyMutation();
                    if(!contains(mutations, mut))
                    {
                        mutations[mutations.length] = mut;
                        break;
                    }                
                }
            }
        }

        return mutations;
    }

    function isInbredMutation(mutation)
    {
        for(var i = 0; i < inbredMutationRules.length; i++)
        {
            if(inbredMutationRules[i][0] == mutation)
                return true;
        }

        return false;
    }

    function getInheritedMutations(mumMut, dadMut)
    {
        var inherited = [];

        for(var i = 0; i < mumMut.length; i++)
        {
            if(!isInbredMutation(mumMut[i]) && !contains(inherited, mumMut[i]))
            {
                var roll = RollMe(1,100);
                if(roll <= 5)
                {
                    inherited[inherited.length] = mumMut[i];
                }
            }
        }

        for(var i = 0; i < dadMut.length; i++)
        {
            if(!isInbredMutation(dadMut[i]) && !contains(inherited, dadMut[i]))
            {
                var roll = RollMe(1,100);
                if(roll <= 5)
                {
                    inherited[inherited.length] = dadMut[i];
                }
            }
        }

        console.log("INHERITEd: " + inherited);

        return inherited;
    }

    function createEgg(mumGenos, dadGenos, mumMarkings, dadMarkings, mumBreed, dadBreed, mumRank, dadRank)
    {
        if(mumBreed != dadBreed)
        {
            var roll = RollMe(1,4);

            logRoll("Breed roll: " + roll);

            if(roll <= 3)
            {
                breed = "Common";
            }
            else
                breed = "Prairie";
        }
        else
        {
            breed = mumBreed;
        }

        var gender;
        var breed;
        var mumAtk = document.getElementById("mumATK").value;
        var dadAtk = document.getElementById("dadATK").value;
        var babyAtk =calculateSkillpoints(mumAtk);
        babyAtk +=calculateSkillpoints(dadAtk);

        var mumDef = document.getElementById("mumDEF").value;
        var dadDef = document.getElementById("dadDEF").value;
        var babyDef =calculateSkillpoints(mumDef);
        babyDef +=calculateSkillpoints(dadDef);

        var mumSpd = document.getElementById("mumSPD").value;
        var dadSpd = document.getElementById("dadSPD").value;
        var babySpd =calculateSkillpoints(mumSpd);
        babySpd +=calculateSkillpoints(dadSpd);

        var genderRoll = RollMe(1,2);
        if(genderRoll == 1) { gender = "Male"; } else { gender = "Female" };
        logRoll("Gender roll: " + genderRoll);

        // Calculate base color

        var AaColor;
        var EeColor;
        var XoColor;

        for(var i = 0; i < 100; i++) // We attempt to make the base color 100 times in case we get an "illegal" base color
        {
            AaColor = calculateBaseColor(mumGenos[0], dadGenos[0], AaRules);
            EeColor = calculateBaseColor(mumGenos[1], dadGenos[1], EeRules);

            XoColor = getXoColor(mumGenos, dadGenos);

            var baseColorCombined =AaColor + "/" + EeColor;

            if(XoColor != "xx" && XoColor != "oo" && XoColor != "--" && XoColor != "") // We know there is no xx or oo color in base coats, but they can still be inherited as non-dominant
            {
                baseColorCombined += "/" + XoColor;
            }

            if(isValidBaseColor(baseColorCombined))
            {
                console.log("This is a valid base color. " + baseColorCombined);
                break; // we have confirmed that this base color is accepted
            }               
        }      

        var babyMarkings = calculateMarkingssss(mumMarkings, dadMarkings);

        var ears = calculateEars(document.getElementById("mumEars").value, document.getElementById("dadEars").value, earsRules);
        var horns =calculateHorns(document.getElementById("mumHorns").value, document.getElementById("dadHorns").value, hornsRules);

        var mumTail = tails[document.getElementById("mumTail").value][0];
        var dadTail = tails[document.getElementById("dadTail").value][0];

        var tail = calculateTail(mumTail, dadTail);
        if(tail == "None")
            tail = "Regular";

        if(tail == "Short")
        {
            babySpd -= 1;
        }

        var ruffle =calculateRuffle(ruffles[document.getElementById("mumRuffle").value][0], ruffles[document.getElementById("dadRuffle").value][0]);

        var tailStr = "";
        var ruffleStr = "";
        var XoColorStr = "";

        var baseColor = [];
        baseColor[0] = AaColor;
        baseColor[1] = EeColor;
        if(XoColor != "" && XoColor != "--")
            baseColor[2] = XoColor;

        var phenotype = getPhenotype(baseColor, babyMarkings);

        if(tail != "Regular")
        {
            tailStr = tail + " Tail";

            if(ruffle == "None")
            {
                tailStr += "</br>";
            }
        }

        if(ruffle != "None")
        {
            if(tail != "Regular")
            {
                tailStr += ","
            }

            ruffleStr = ruffle + " Ruffle </br>";
        }

        if(XoColor != "" && XoColor != "--" )
        {
            XoColorStr = XoColor + "/";
        }

        var skillPointsStr = "";

        var mumMutationsAr = [];
        var dadMutationsAr = [];

        var mumMut = document.getElementById("mumMutations");
        var dadMut = document.getElementById("dadMutations");

        for(var i = 0; i < mumMut.options.length; i++)
        {
            if(mumMut.options[i].selected)
            {
                mumMutationsAr[mumMutationsAr.length] = mumMut.options[i].value;
            }
        }

        for(var i = 0; i < dadMut.options.length; i++)
        {
            if(dadMut.options[i].selected)
            {
                dadMutationsAr[dadMutationsAr.length] = dadMut.options[i].value;
            }
        }

        var inheritedMutations = getInheritedMutations(mumMutationsAr, dadMutationsAr);

        for(var i = 0; i < inheritedMutations.length; i++)
        {
            console.log(inheritedMutations[i]);
        }

        var mutations = getMutations();

        for(var i = 0; i < inheritedMutations.length; i++)
        {
            if(!contains(mutations, inheritedMutations[i]))
            {
                mutations[mutations.length] = inheritedMutations[i];
            }
        }

        for(var i = 0; i < mutations.length; i++)
        {
            var skillPointsEffects = getMutationSkillPointEffect(mutations[i]);

            babyAtk += skillPointsEffects[0];
            babyDef += skillPointsEffects[1];
            babySpd += skillPointsEffects[2];
        }

        if(babyAtk != 0)
        {
            skillPointsStr += "ATK " + babyAtk + " ";
        }
        if(babyDef != 0)
        {
            skillPointsStr += "DEF " + babyDef + " " ;
        }
        if(babySpd != 0)
        {
            skillPointsStr += "SPD " + babySpd + " " ;
        }

        if(skillPointsStr != "")
        {
            skillPointsStr += "</br>";
        }

        var bioryhtmnStr = "Biorhythm: ";
        bioryhtmnStr += calculateBaseColor(biorythmns[document.getElementById("mumBiorythmn").value], biorythmns[document.getElementById("dadBiorythmn").value], biorythmnRules);

        var dietStr = "Diet: ";

        dietStr += calculateBaseColor(diets[document.getElementById("mumDiet").value], diets[document.getElementById("dadDiet").value], dietRules);

        var str;

        var feathertypeStr = "";

        mutationStr = "";

        for(var i = 0; i < mutations.length; i++)
        {
            mutationStr += mutations[i];

            if(i != mutations.length-1)
                mutationStr += "</br>"
        }

        var deadStr = "";
        var infertileStr = "";

        if(document.getElementById('inbred').checked)
        {
            var roll = RollMe(1,100);
            logRoll("Inbred dead roll (1-100): " + roll);
            if(roll <= 30)
            {
                deadStr = "</br>DEAD";
            }

            roll = RollMe(1,100);
            logRoll("Inbred infertile roll (1-100): " + roll);
            if(roll <= 80)
            {
                infertileStr = "</br>Infertile";
            }
        }        

        if(breed == "Prairie")
        {
            feathertypeStr = "Feathertype: " + calculateFeathertype(featherTypes[document.getElementById("mumFeathertype").value][0], 
            featherTypes[document.getElementById("dadFeathertype").value][0], feathertypesRules) + " </br>";
        }

        str = breed + " Kukuri - " + gender + "<br/>"
                + AaColor + "/" + EeColor + "/" + XoColorStr + babyMarkings + "<br/>"                
                + phenotype + "</br>"
                + ears + " Ears, " + horns + " Horns" + "<br/>"
                + feathertypeStr
                + tailStr + " " + ruffleStr
                + skillPointsStr
                + dietStr + "</br>"
                + bioryhtmnStr + "</br>"
                + mutationStr
                + deadStr
                + infertileStr + "</br>";

        return str;
    }

    function hasMutation(mutation, parent)
    {
        if(parent == "mum")
        {
            var mumMut = document.getElementById("mumMutations");            

            for(var i = 0; i < mumMut.options.length; i++) {

                if(mumMut.options[i].selected)
                {
                    if(mutation == mumMut.options[i].value)
                        return true;
                }
            }
        }
        else
        {
            var dadMut = document.getElementById("dadMutations");

            for(var i = 0; i < dadMut.options.length; i++)
            {
                if(dadMut.options[i].selected)
                {
                    if(mutation == dadMut.options[i].value)
                        return true;
                }
            }

        }

        return false;
    }

    function breed()
    {
        console.log("Breed!");      

        clearLog();
        logRoll("Breed!");

        var mumgeno = document.getElementById("mumgeno").value;
        var dadgeno = document.getElementById("dadgeno").value;

        if(mumgeno.slice(-1) == "/")
        {
            mumgeno = mumgeno.substring(0, mumgeno.length - 1);
        }

        if(dadgeno.slice(-1) == "/")
        {
            dadgeno = dadgeno.substring(0, dadgeno.length - 1);
        }

        var mumGenos = mumgeno.split("/");
        var dadGenos = dadgeno.split("/");

        var mumMarkings = getMarkings(mumGenos);
        var dadMarkings = getMarkings(dadGenos);

        var mumBreed = document.getElementById("mumBreed").value;
        var dadBreed = document.getElementById("dadBreed").value;

        console.log("mumBreed: " + mumBreed + " dadBreed: " + dadBreed);       

        var mumRank = ranks[document.getElementById("mumRank").value];
        var dadRank = ranks[document.getElementById("dadRank").value];

        var mumMutationsAr = [];
        var dadMutationsAr = [];

        var mumMut = document.getElementById("mumMutations");
        var dadMut = document.getElementById("dadMutations");

        for(var i = 0; i < mumMut.options.length; i++)
        {
            if(mumMut.options[i].selected)
            {
                mumMutationsAr[mumMutationsAr.length] = mumMut.options[i].value;
            }
        }

        for(var i = 0; i < dadMut.options.length; i++)
        {
            if(dadMut.options[i].selected)
            {
                dadMutationsAr[dadMutationsAr.length] = dadMut.options[i].value;
            }
        }

        logRoll("Rolling mum accept breeding...");
        var mumAccept = accepts(mumRank, dadRank, mumMutationsAr, dadMutationsAr, "dove", "rook");
        logRoll("Rolling dad accept breeding...");
        var dadAccept = accepts(dadRank, mumRank, dadMutationsAr, mumMutationsAr, "rook", "dove");    

        if(mumAccept[0] == false || dadAccept[0] == false)
        {
            var returnStr = "";
            if(mumAccept[0] == false)
            {
                returnStr += mumAccept[1] + "<br/>";
            }

            if(dadAccept[0] == false)
            {
                returnStr += dadAccept[1] + "<br/>";
            }

            return returnStr;
        }

        var nestSize =getNestSize(mumRank, dadRank, mumMutationsAr, dadMutationsAr, document.getElementById('inbred').checked);
        console.log("NestSize: " + nestSize);

        var nestStr = "";

        if(nestSize == 0)
        {
            return "The dove and the rook mated, but produced an empty nest.";
        }

        for(var i = 0; i < nestSize; i++)
        {
            logRoll("*** Creating the egg: " + (i+1) + "/" + nestSize + " ***");

            console.log("Trying to create an egg");
            nestStr += createEgg(mumGenos, dadGenos, mumMarkings, dadMarkings, mumBreed, dadBreed, mumRank, dadRank);
            nestStr += "<br/><br/>";
        }

        return nestStr;
    }

    var rollLog = "";

    function logRoll(log)
    {
        rollLog += log + "\n";
        document.getElementById("rollLog").innerHTML = rollLog;
    }

    function clearLog()
    {
        rollLog = "";
        document.getElementById("rollLog").innerHTML = rollLog;
    }

    function getEarsRarity(earsType)
    {
        var rarities  = ["Common", "Uncommon", "Rare"]; // helper array to help use the number coded rarities

        // Find ears rarity
        for(var i = 0; i < ears.length; i++)
        {
            //console.log("Checking " + ears[i][0] + " and " + earsType);

            if(ears[i][0] == earsType)
            {
                return rarities[ears[i][1]];
            }
        }

        console.log("ERROR! Could not find Ears rarity");

        return "ERROR! Could not find Ears rarity";
    }

    function calculateEars(ears1, ears2, rules) // give rarity rules here
    {
        ears1 = ears[ears1][0];
        ears2 = ears[ears2][0];

        var ears1rarity = getEarsRarity(ears1);
        var ears2rarity = getEarsRarity(ears2);

        if(ears1rarity == ears2rarity) // If parents ears rarity is the same
        {
            console.log("Ears are the same rarity " + ears1rarity);

            var roll = RollMe(1,2);
            logRoll("Ears are the same rarity. Roll: " + roll);
            if(roll == 1)
            {
                return ears1;
            }
            else
                return ears2;
                
        }

        for(var i = 0; i < rules.length; i++)
        {
            if(rules[i][0] == ears1rarity && rules[i][1] == ears2rarity || rules[i][0] == ears2rarity && rules[i][1] == ears1rarity)
            {
                var roll = RollMe(1, 100);
                logRoll("Ears roll: " + roll);

                for(j = 0; j < rules[i][2].length; j++)
                {
                    if(roll >= rules[i][2][j][0] && roll <= rules[i][2][j][1]) // if roll is within the written roll limits
                    {
                        var rarity = rules[i][2][j][2]; // Uncommon, Rare.. etc

                        if(rarity == ears1rarity)
                            return ears1;
                        else 
                            return ears2;
                    } 
                }

                break;
            }
        }

        return "ERROR: Could not calculate ears";
    }

     function getHornsRarity(hornsType)
    {
        var rarities  = ["Common", "Uncommon", "Rare"]; // helper array to help use the number coded rarities

        // Find horns rarity
        for(var i = 0; i < horns.length; i++)
        {
            //console.log("Checking " + horns[i][0] + " and " + hornsType);

            if(horns[i][0] == hornsType)
            {
                return rarities[horns[i][1]];
            }
        }

        console.log("ERROR! Could not find Horns rarity");

        return "ERROR! Could not find Horns rarity";
    }

    function calculateHorns(horns1, horns2, rules) // rules is rarity rules
    {
        console.log("Calculate horns before: " + horns1);

        horns1 = horns[horns1][0]; // turn numbers into string values (2 => Rhino)
        horns2 = horns[horns2][0];

        console.log("Calculate horns after: " + horns1);

        var horns1rarity = getHornsRarity(horns1);
        var horns2rarity = getHornsRarity(horns2);

        if(horns1rarity == horns2rarity) // If parents horns rarity is the same
        {
            console.log("Horns are the same rarity " + horns1rarity);

            var roll = RollMe(1,2);
            logRoll("Horns are the same rarity. Roll: " + roll);
            if(roll == 1)
            {
                return horns1;
            }
            else
                return horns2;
                
        }

        for(var i = 0; i < rules.length; i++) // If parents horns rarity differs
        {
            if(rules[i][0] == horns1rarity && rules[i][1] == horns2rarity || rules[i][0] == horns2rarity && rules[i][1] == horns1rarity)
            {
                var roll = RollMe(1, 100);

                for(j = 0; j < rules[i][2].length; j++)
                {
                    if(roll >= rules[i][2][j][0] && roll <= rules[i][2][j][1]) // if roll is within the written roll limits
                    {
                        var rarity = rules[i][2][j][2]; // Uncommon, Rare.. etc

                        if(rarity == horns1rarity)
                            return horns1;
                        else 
                            return horns2;
                    } 
                }

                break;
            }
        }

        return "ERROR: Could not calculate horns";
    }

    function getTailRarity(tail)
    {
        for(var i = 0; i < tails.length; i++)
        {
            if(tail == tails[i][0])
                return tails[i][1];
        }
    }

    function getTailByRarity(rarity)
    {
        for(var i = 0; i < tails.length; i++)
        {
            if(rarity == tails[i][1])
                return tails[i][0];
        }
    }

    function calculateTail(tail1, tail2)
    {
        var tail1Rarity = getTailRarity(tail1);
        var tail2Rarity = getTailRarity(tail2);

        for(var i = 0; i < tailsRufflesRules.length; i++)
        {
             //console.log("Checking if " + tailsRufflesRules[i][0] + " or "  + tailsRufflesRules[i][1] + " matches " + tail1Rarity + " and " + tail2Rarity);

             if(tailsRufflesRules[i][0] == tail1Rarity && tailsRufflesRules[i][1] == tail2Rarity || 
                tailsRufflesRules[i][0] == tail2Rarity && tailsRufflesRules[i][1] == tail1Rarity)
            {
                //console.log("Going through rule" + i);

                var roll = RollMe(1, 100);
                logRoll("Tail roll: " + roll);

                //console.log(roll);

                for(var j = 0; j < tailsRufflesRules[i][2].length; j++)
                {
                    if(roll >= tailsRufflesRules[i][2][j][0] && roll <= tailsRufflesRules[i][2][j][1]) // if roll is within the written roll limits
                    {
                        return getTailByRarity(tailsRufflesRules[i][2][j][2]);
                    } 
                }

                break;
            }
        }
    }

    function getRuffleRarity(ruffle)
    {
        for(var i = 0; i < ruffles.length; i++)
        {
            if(ruffle == ruffles[i][0])
                return ruffles[i][1];
        }
    }

    function getRuffleByRarity(rarity)
    {
        for(var i = 0; i < ruffles.length; i++)
        {
            if(rarity == ruffles[i][1])
                return ruffles[i][0];
        }
    }

     var baseColors = 
    [
        ["Crimson", 
            [
                "Aa/ee", "AA/ee"
            ],
            [
                ["Velvet Crimson", ["Oo", "OO"]],
                ["Ebon Crimson", ["Xx", "XX"]]
            ]
        ],
        ["Hazel",
            [
                "aa/Ee", "aa/EE"
            ],
            [
                ["Velvet Hazel", ["Oo", "OO"]],
                ["Ebon Hazel", ["Xx", "XX"]]
            ]
        ],
        ["Raven",
            [
                "aa/ee/Xx",  "aa/ee/XX"
            ]
        ],
        ["Pearl",
            [
                "aa/ee/Oo",  "aa/ee/OO"
            ]
        ],
        ["Amber",
            [
                "Aa/Ee", "AA/Ee", "Aa/EE", "AA/EE"
            ],
            [
                ["Jade", ["Oo", "OO"]],
                ["Azure", ["Xx", "XX"]]
            ]
        ]
    ]

    function isValidBaseColor(baseColor)
    {
        console.log(baseColors.length);

        for(var i = 0; i < baseColors.length; i++)
        {
            for(var j = 0; j < baseColors[i][1].length; j++)
            {
                console.log("Checking if " + baseColors[i][1][j] + " is " + baseColor); // TODO add XX and OO and stuff

                if(baseColors[i][1][j] == baseColor)
                    return true;
            }
        }

        logRoll(baseColor + " is not a valid base color! Rerolling.");
        console.log(baseColor + " is not valid base color!");

        return false;
    }

    function getPhenotype(baseColor, kukuriMarkings)
    {
        var genoStr = "";
        var phenoStr = "";

        genoStr = baseColor[0] + "/";
        genoStr += baseColor[1];       

        if(kukuriMarkings.length == 0 && kukuriMarkings[0] == "")
            markingsAr = [];

        // We don't care about small xx and oo with phenotypes since they are non-dominant genes
        if(baseColor[2] == "Xx" || baseColor[2] == "XX" || baseColor[2] == "Oo" || baseColor[2] == "OO") 
        {
            genoStr += "/"+ baseColor[2];
        }

        console.log(genoStr);

        var baseColorStr = "";

        console.log(baseColors.length);
        var found = false;

        for(var i = 0; i < baseColors.length; i++)
        {
            console.log(baseColors[i]);

            for(var j = 0; j < baseColors[i][1].length; j++) // 
            {
                console.log(baseColors[i][1][j]); // Basic color, Aa/Ee etc.

                if(baseColors[i][1][j] == genoStr)
                {
                     phenoStr = baseColors[i][0];
                     break;
                }

                if(baseColors[i].length > 2)
                {
                    for(var k = 0; k < baseColors[i][2].length; k++)
                    {
                        for(var m = 0; m < baseColors[i][2][k][1].length; m++)
                        {
                            var fullGeno = baseColors[i][1][j] + "/" + baseColors[i][2][k][1][m];

                            if(genoStr == fullGeno)
                            {
                                phenoStr = baseColors[i][2][k][0];
                                break;
                            }
                        }
                    }
                }
            }
        }

        if(kukuriMarkings == "") // No markings
            return phenoStr;

        var markingsAr = kukuriMarkings.split("/");
        var markingsStr = "";

        if(markingsAr.length > 0)
            markingsStr = " with ";

        console.log("MarkingsAr length: " + markingsAr.length);
        console.log("Markings length: " + markings.length);
        
        for(var i = 0; i < markingsAr.length; i++)
        {
            console.log("What is i? " + i + " " + markingsAr[i]);

            for(var j = 0; j < markings.length; j++)
            {
                console.log("Checking if " + markingsAr[i] + " matches " + markings[j][1] + " or " + markings[j][2]);

                if(markingsAr[i] == markings[j][1] || markingsAr[i] == markings[j][2]) {
                  
                     if(markingsAr.length >= 2 && i == markingsAr.length-1)
                     {
                        markingsStr += " and ";
                        markingsStr += markings[j][0];
                     }
                     else
                     {
                        markingsStr += markings[j][0];

                        if(markingsAr.length >= 2 && i != markingsAr.length-2)               
                            markingsStr += ", "
                     }

                     break;
                }                   
            }
        }

        if(markingsStr.length > 0)
        {
            if (markingsStr[markingsStr.length-1] == ",")
                markingsStr = markingsStr.substring(0, markingsStr.length - 1);
        }

        phenoStr += markingsStr;
        return phenoStr;
    }



    function onChangeMumGenoFocus()
    {
        var mumgeno = document.getElementById("mumgeno").value;
        var dadgeno = document.getElementById("dadgeno").value;
        var mumGenos = mumgeno.split("/");
        var mumMarkings = getMarkings(mumGenos);
        console.log(typeof(mumMarkings));
        console.log("MumMarkings length: " + mumMarkings.length);

        var AaColor =mumGenos[0];
        var EeColor =mumGenos[1];
        var XoColor = "";

        if(mumGenos.length > 2)
        {
            if(mumGenos[2].toLowerCase() == "xx" || mumGenos[2].toLowerCase() == "oo")
            {
                XoColor = mumGenos[2];
            }
        }

        var baseColor = [];
        baseColor[0] = AaColor;
        baseColor[1] = EeColor;
        if(XoColor != "" && XoColor != "--")
            baseColor[2] = XoColor;

        var mumMarkingsStr = "";

        for(var i = 0; i < mumMarkings.length; i++)
        {
            mumMarkingsStr += mumMarkings[i]+"/";
        }

        var phenotype = getPhenotype(baseColor, mumMarkingsStr);
        document.getElementById("mumPhenotype").innerHTML = phenotype;
    }

     function onChangeDadGenoFocus()
    {
        var dadgeno = document.getElementById("dadgeno").value;
        var dadGenos = dadgeno.split("/");
        var dadMarkings = getMarkings(dadGenos);

        var AaColor =dadGenos[0];
        var EeColor =dadGenos[1];
        var XoColor = "";

        if(dadGenos.length > 2)
        {
            if(dadGenos[2].toLowerCase() == "xx" || dadGenos[2].toLowerCase() == "oo")
            {
                XoColor = dadGenos[2];
            }
        }

        var baseColor = [];
        baseColor[0] = AaColor;
        baseColor[1] = EeColor;
        if(XoColor != "" && XoColor != "--")
            baseColor[2] = XoColor;

        var dadMarkingStr = "";

        for(var i = 0; i < dadMarkings.length; i++)
        {
            dadMarkingStr += dadMarkings[i]+"/";
        }

        for(var i = 0; i <baseColor.length; i++)
        {
            console.log(baseColor[i]);
        }

        var phenotype = getPhenotype(baseColor, dadMarkingStr);
        document.getElementById("dadPhenotype").innerHTML = phenotype;
    }

    function calculateRuffle(ruffle1, ruffle2)
    {
        var ruffle1Rarity = getRuffleRarity(ruffle1);
        var ruffle2Rarity = getRuffleRarity(ruffle2);

        for(var i = 0; i < tailsRufflesRules.length; i++)
        {
             //console.log("Checking if " + tailsRufflesRules[i][0] + " or "  + tailsRufflesRules[i][1] + " matches " + tail1Rarity + " and " + tail2Rarity);

             if(tailsRufflesRules[i][0] == ruffle1Rarity && tailsRufflesRules[i][1] == ruffle2Rarity || 
                tailsRufflesRules[i][0] == ruffle2Rarity && tailsRufflesRules[i][1] == ruffle1Rarity)
            {
                //console.log("Going through rule" + i);

                var roll = RollMe(1, 100);
                logRoll("Ruffle roll: " + roll);

                //console.log(roll);

                for(var j = 0; j < tailsRufflesRules[i][2].length; j++)
                {
                    if(roll >= tailsRufflesRules[i][2][j][0] && roll <= tailsRufflesRules[i][2][j][1]) // if roll is within the written roll limits
                    {
                        return getRuffleByRarity(tailsRufflesRules[i][2][j][2]);
                    } 
                }

                break;
            }
        }
    }

    function calculateMarkings(color1, color2, rules)
    {
        for(var i = 0; i < rules.length; i++)
        {
            console.log("Going through rules!");

            //console.log("Checking if " + rules[i][0] + " or "  + rules[i][1] + " matches " + color1 + " and " + color2);

            if(rules[i][0] == color1 && rules[i][1] == color2 || rules[i][0] == color2 && rules[i][1] == color1)
            {
                console.log("Going through rule" + i);

                var roll = RollMe(1, 100);

                console.log(roll);

                for(var j = 0; j < rules[i][2].length; j++)
                {
                    if(roll >= rules[i][2][j][0] && roll <= rules[i][2][j][1]) // if roll is within the written roll limits
                    {
                        return rules[i][2][j][2];
                    } 
                }

                break;
            }
        }

        return undefined;
    }

    function calculateBaseColor(color1, color2, rules)
    {
        for(var i = 0; i < rules.length; i++)
        {
            if(rules[i][0] == color1 && rules[i][1] == color2 || rules[i][0] == color2 && rules[i][1] == color1)
            {
                var roll = RollMe(1, 100);
                logRoll(color1 + " and " + color2 + " roll: " + roll);

                for(var j = 0; j < rules[i][2].length; j++)
                {
                    if(roll >= rules[i][2][j][0] && roll <= rules[i][2][j][1]) // if roll is within the written roll limits
                    {
                        return rules[i][2][j][2];
                    } 
                }

                break;
            }
        }

        return undefined;
    }

    function RollMe(min, max)
    {
        return Math.floor(Math.random() * (max - min + 1) + min);
    }

    function populate(sel, options)
    {
        if (sel) {
            for(var i = 0; i < options.length; i++)
                {
                    sel.options[i] =new Option(options[i][0], i);
                }       
            }
            else {
                alert("Could not populate!");
            }
    }

    function populateOneDimensionSelection(sel, ar) // From a simple one-dimensional array 
    {
        if (sel) 
        {
            for(var i = 0; i < ar.length; i++)
            {
                sel.options[i] =new Option(ar[i], i);
            }       
        }
        else {
            alert("Could not populate " + sel.name);
        }
    }

    function populateMutations(sel)
    {
        if (sel) {

            var counter = 0;

            for(var i = 0; i < randomMutationRules.length; i++)
            {
                for(var j = 0; j < randomMutationRules[i][2].length; j++)
                {
                    counter++;
                    sel.options[counter] = new Option(randomMutationRules[i][2][j][0], randomMutationRules[i][2][j][0]);
                }                    
            }

            for(var i = 0; i < inbredMutationRules.length; i++)
            {
                counter++;
                sel.options[counter] = new Option(inbredMutationRules[i][0], inbredMutationRules[i][0]);              
            }    
        }
    }

    window.onload = function() {

        document.getElementById("rollLog").style.display = "none";

        populateOneDimensionSelection(document.breeder.mumRank, ranks);
        populateOneDimensionSelection(document.breeder.dadRank, ranks);
        populateOneDimensionSelection(document.breeder.dadBiorythmn, biorythmns);
        populateOneDimensionSelection(document.breeder.mumBiorythmn, biorythmns);
        populateOneDimensionSelection(document.breeder.dadDiet, diets);
        populateOneDimensionSelection(document.breeder.mumDiet, diets);

        populate(document.breeder.mumEars, ears);
        populate(document.breeder.dadEars, ears);
        populate(document.breeder.mumHorns, horns);
        populate(document.breeder.dadHorns, horns);

        populate(document.breeder.mumTail, tails);
        document.breeder.mumTail.options[0].innerHTML = "Regular";
        populate(document.breeder.dadTail, tails);
        document.breeder.dadTail.options[0].innerHTML = "Regular";

        populate(document.breeder.mumRuffle, ruffles);
        populate(document.breeder.dadRuffle, ruffles);

        populate(document.breeder.mumFeathertype, featherTypes);
        populate(document.breeder.dadFeathertype, featherTypes);

        populateMutations(document.breeder.mumMutations);
        populateMutations(document.breeder.dadMutations);

    };

</script>




</body>

</html>